window.gamecore={hasOwn:Object.prototype.hasOwnProperty,isFunction:function(a){return!(!a||!a.constructor||!a.call||!a.apply)},isWindow:function(a){return!(!a||!a.setInterval)},isArray:Array.isArray||function(a){return a.constructor===Array},isString:function(a){return"string"==typeof a},isObject:function(a){return a===Object(a)},isPlainObject:function(a){if(!a||this.isObject(a)||a.nodeType||this.isWindow(a))return!1;try{if(a.constructor&&!this.hasOwn.call(a,"constructor")&&!this.hasOwn.call(a.constructor.prototype,
"isPrototypeOf"))return!1}catch(b){return!1}for(var c in a);return void 0===c||this.hasOwn.call(a,c)},extend:function(){var a,b,c,d,e,f=arguments[0]||{},g=1,h=arguments.length,m=!1;"boolean"===typeof f&&(m=f,f=arguments[1]||{},g=2);"object"!==typeof f&&!gamecore.isFunction(f)&&(f={});h===g&&(f=this,--g);for(;g<h;g++)if(null!=(a=arguments[g]))for(b in a)c=f[b],d=a[b],f!==d&&(m&&d&&(this.isPlainObject(d)||(e=this.isArray(d)))?(e?(e=!1,c=c&&this.isArray(c)?c:[]):c=c&&this.isPlainObject(c)?c:{},f[b]=
this.extend(m,c,d)):void 0!==d&&(f[b]=d));return f}};gamecore.push=Array.prototype.push;gamecore.merge=function(a,b){var c=a.length,d=0;if("number"===typeof b.length)for(var e=b.length;d<e;d++)a[c++]=b[d];else for(;void 0!==b[d];)a[c++]=b[d++];a.length=c;return a};gamecore.makeArray=function(a,b){var c=b||[];null!=a&&(null==a.length||gamecore.isString(a)||gamecore.isFunction(a)||gamecore.isWindow(a)?gamecore.push.call(c,a):gamecore.merge(c,a));return c};
gamecore.each=function(a,b,c){var d,e=0,f=a.length,g=void 0===f||gamecore.isFunction(a);if(c)if(g)for(d in a){if(!1===b.apply(a[d],c))break}else for(;e<f&&!1!==b.apply(a[e++],c););else if(g)for(d in a){if(!1===b.call(a[d],d,a[d]))break}else for(;e<f&&!1!==b.call(a[e],e,a[e++]););return a};gamecore._flagsCache={};gamecore.createFlags=function(a){var b=gamecore._flagsCache[a]={},c,d;a=a.split(/\s+/);c=0;for(d=a.length;c<d;c++)b[a[c]]=!0;return b};
gamecore.Callbacks=function(a){a=a?gamecore._flagsCache[a]||gamecore.createFlags(a):{};var b=[],c=[],d,e,f,g,h,m=function(c){var d,e,f;d=0;for(e=c.length;d<e;d++)f=c[d],gamecore.isArray(f)?m(f):gamecore.isFunction(f)&&(!a.unique||!k.has(f))&&b.push(f)},l=function(s,t){t=t||[];d=!a.memory||[s,t];e=!0;h=f||0;f=0;for(g=b.length;b&&h<g;h++)if(!1===b[h].apply(s,t)&&a.stopOnFalse){d=!0;break}e=!1;b&&(a.once?!0===d?k.disable():b=[]:c&&c.length&&(d=c.shift(),k.fireWith(d[0],d[1])))},k={add:function(){if(b){var a=
b.length;m(arguments);e?g=b.length:d&&!0!==d&&(f=a,l(d[0],d[1]))}return this},remove:function(){if(b)for(var c=arguments,d=0,f=c.length;d<f;d++)for(var k=0;k<b.length&&!(c[d]===b[k]&&(e&&k<=g&&(g--,k<=h&&h--),b.splice(k--,1),a.unique));k++);return this},has:function(a){if(b)for(var c=0,d=b.length;c<d;c++)if(a===b[c])return!0;return!1},empty:function(){b=[];return this},disable:function(){b=c=d=void 0;return this},disabled:function(){return!b},lock:function(){c=void 0;(!d||!0===d)&&k.disable();return this},
locked:function(){return!c},fireWith:function(b,f){c&&(e?a.once||c.push([b,f]):(!a.once||!d)&&l(b,f));return this},fire:function(){k.fireWith(this,arguments);return this},fired:function(){return!!d}};return k};
gamecore.extend({Deferred:function(a){var b=gamecore.Callbacks("once memory"),c=gamecore.Callbacks("once memory"),d=gamecore.Callbacks("memory"),e="pending",f={resolve:b,reject:c,notify:d},g={done:b.add,fail:c.add,progress:d.add,state:function(){return e},isResolved:b.fired,isRejected:c.fired,then:function(a,b,c){h.done(a).fail(b).progress(c);return this},always:function(){h.done.apply(h,arguments).fail.apply(h,arguments);return this},pipe:function(a,b,c){return gamecore.Deferred(function(d){gamecore.each({done:[a,
"resolve"],fail:[b,"reject"],progress:[c,"notify"]},function(a,b){var c=b[0],f=b[1],e;if(gamecore.isFunction(c))h[a](function(){if((e=c.apply(this,arguments))&&gamecore.isFunction(e.promise))e.promise().then(d.resolve,d.reject,d.notify);else d[f+"With"](this===h?d:this,[e])});else h[a](d[f])})}).promise()},promise:function(a){if(null==a)a=g;else for(var b in g)a[b]=g[b];return a}},h=g.promise({}),m;for(m in f)h[m]=f[m].fire,h[m+"With"]=f[m].fireWith;h.done(function(){e="resolved"},c.disable,d.lock).fail(function(){e=
"rejected"},b.disable,d.lock);a&&a.call(h,h);return h},when:function(a){function b(a){return function(b){e[a]=1<arguments.length?d.call(arguments,0):b;--m||l.resolveWith(l,e)}}function c(a){return function(b){h[a]=1<arguments.length?d.call(arguments,0):b;l.notifyWith(k,h)}}var d=[].slice,e=d.call(arguments,0),f=0,g=e.length,h=Array(g),m=g,l=1>=g&&a&&gamecore.isFunction(a.promise)?a:gamecore.Deferred(),k=l.promise();if(1<g){for(;f<g;f++)e[f]&&e[f].promise&&gamecore.isFunction(e[f].promise)?e[f].promise().then(b(f),
l.reject,c(f)):--m;m||l.resolveWith(l,e)}else l!==a&&l.resolveWith(l,g?[a]:[]);return k}});
(function(a){var b=/_|-/,c=/::/,d=/([A-Z]+)([A-Z][a-z])/g,e=/([a-z\d])([A-Z])/g,f=/([a-z\d])([A-Z])/g,g=/\{([^\}]+)\}/g,h=/\./,m=function(a){return(a=typeof a)&&("function"==a||"object"==a)},l=function(b,c,d){b=b?b.split(h):[];var f=b.length;c=a.isArray(c)?c:[c||window];var e,n,k,g=0;if(0==f)return c[0];for(;e=c[g++];){for(k=0;k<f-1&&m(e);k++)e=e[b[k]]||d&&(e[b[k]]={});if(m(e)&&(n=e[b[k]]||d&&(e[b[k]]={}),void 0!==n))return!1===d&&delete e[b[k]],n}},k=a.String={getObject:l,capitalize:function(a,b){return a.charAt(0).toUpperCase()+
a.substr(1)},camelize:function(a){a=k.classize(a);return a.charAt(0).toLowerCase()+a.substr(1)},classize:function(a,c){for(var d=a.split(b),e=0;e<d.length;e++)d[e]=k.capitalize(d[e]);return d.join(c||"")},niceName:function(a){return k.classize(a," ")},underscore:function(a){return a.replace(c,"/").replace(d,"$1_$2").replace(e,"$1_$2").replace(f,"_").toLowerCase()},sub:function(a,b,c){var d=[];d.push(a.replace(g,function(a,e){var f=l(e,b,"boolean"==typeof c?!c:c),k=typeof f;return("object"===k||"function"===
k)&&null!==k?(d.push(f),""):""+f}));return 1>=d.length?d[0]:d}}})(gamecore);
(function(a){var b=!1,c=a.makeArray,d=a.isFunction,e=a.isArray,f=a.extend,g=function(a){if(!a||"object"!=typeof a)return a;if(a instanceof Array){for(var b=[],c=0;c<a.length;c++)b[c]=g(a[c]);return b}b={};for(c in a)b[c]=g(a[c]);return b},h=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,m=function(a,b,c){c=c||a;for(var e in a)c[e]=d(a[e])&&d(b[e])&&h.test(a[e])?function(a,c){return function(){var d=this._super,e;this._super=b[a];e=c.apply(this,arguments);this._super=d;return e}}(e,a[e]):a[e]},l=a.Class=
function(){if(arguments.length)return l.extend.apply(l,arguments)};f(l,{callback:function(a){var b=c(arguments),d;a=b.shift();e(a)||(a=[a]);d=this;return function(){for(var f=b.concat(c(arguments)),g,h=a.length,n=0,r;n<h;n++)if(r=a[n]){if((g="string"==typeof r)&&d._set_called)d.called=r;f=(g?d[r]:r).apply(d,f||[]);n<h-1&&(f=!e(f)||f._use_call?[f]:f)}return f}},getObject:a.String.getObject,newInstance:function(){var a=this.rawInstance(),b;a.setup&&(b=a.setup.apply(a,arguments));for(var c in a.__proto__)a[c]=
g(a[c]);a.init&&a.init.apply(a,e(b)?b:arguments);return a},setup:function(a,b){this.defaults=f(!0,{},a.defaults,this.defaults);void 0==this._types&&(this._types=[]);this._types.push(this.fullName);void 0==this._fullTypeName&&(this._fullTypeName="|");this._fullTypeName+=this.fullName+"|";return arguments},rawInstance:function(){b=!0;var a=new this;b=!1;return a},extend:function(a,d,e){function h(){if(!b)return this.constructor!==h&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):
this.Class.newInstance.apply(this.Class,arguments)}"string"!=typeof a&&(e=d,d=a,a=null);e||(e=d,d=null);e=e||{};var p=this.prototype,q,n,r,u;this.isA=function(a){return-1!=this._fullTypeName.indexOf("|"+a+"|")};b=!0;u=new this;b=!1;m(e,p,u);for(q in this)this.hasOwnProperty(q)&&(h[q]=g(this[q]));m(d,this,h);a&&(p=a.split(/\./),n=p.pop(),0<p.length&&(r=current=l.getObject(p.join("."),window,!0)),current[n]=h);f(h,{prototype:u,namespace:r,shortName:n,constructor:h,fullName:a});h.prototype.Class=h.prototype.constructor=
h;n=h.setup.apply(h,[this].concat(c(arguments)));h.init&&h.init.apply(h,n||[]);return h}});l.prototype.callback=l.callback})(gamecore);
gamecore.Base=gamecore.Class("gamecore.Base",{totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(a,b,c){if(!0===h5c3.devMode){b="";var d=$GEI("waConsoleLog");a&&(b="["+a+"]");d?(d.value+=this.fullName+b+"-"+c+"\n",d.scrollTop=d.scrollHeight):console.log(this.fullName+b+"-"+c)}},warn:function(a){this.log(null,this.WARN,a)},debug:function(a){this.log(null,this.DEBUG,a)},error:function(a){this.log(null,this.ERROR,a)},info:function(a){this.log(null,this.INFO,a)},assert:function(a,
b){if(!b)throw a;}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++;this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(a){this.Class.log(this.objectId,this.Class.WARN,a)},debug:function(a){this.Class.log(this.objectId,this.Class.DEBUG,a)},error:function(a){this.Class.log(this.objectId,this.Class.ERROR,a)},info:function(a){this.Class.log(this.objectId,
this.Class.INFO,a)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}});
gamecore.Device=gamecore.Base.extend("gamecore.Device",{pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isiPod:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1;this.isiPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone");this.isiPod=-1!=navigator.userAgent.toLowerCase().indexOf("ipod");this.isiPhone4=2==this.pixelRatio&&
this.isiPhone;this.isiPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad");this.isAndroid=-1!=navigator.userAgent.toLowerCase().indexOf("android");this.isFirefox=-1!=navigator.userAgent.toLowerCase().indexOf("firefox");this.isChrome=-1!=navigator.userAgent.toLowerCase().indexOf("chrome");this.isOpera=-1!=navigator.userAgent.toLowerCase().indexOf("opera");this.isTouch="undefined"!==window.ontouchstart;this.isiOS=this.isiPhone||this.iPad||this.isiPod;void 0!=window.performance&&(this.hasMemoryProfiling=
window.performance.memory);/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var a=new Audio;a.canPlayType("audio/ogg")&&(this.canPlayOgg=!0);a.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0);a.canPlayType("audio/x-wav")&&(this.canPlayWav=!0);this.requestAnimFrame=function(){var a=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,
b){window.setTimeout(a,16,Date.now())};return function(c,d){a.apply(window,[c,d])}}()},canPlay:function(a){return"mp3"===a.toLowerCase()&&this.canPlayMP3||"ogg"===a.toLowerCase()&&this.canPlayOgg||"wav"===a.toLowerCase()&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{});
gamecore.HashList=gamecore.Base.extend("gamecore.HashList",{},{hashtable:null,init:function(){this.hashtable=new gamecore.Hashtable},add:function(a,b){var c=this.hashtable.get(a);null==c&&(c=new h5c3.LinkedList,this.hashtable.put(a,c));c.add(b)},remove:function(a,b){var c=this.hashtable.get(a);if(null==c)throw"No list for a key in hashlist when removing";c.remove(b)},get:function(a){return this.hashtable.get(a)}});
gamecore.Hashtable=function(){function a(b){if("string"==typeof b)return b;if(typeof b.hashCode==l)return b=b.hashCode(),"string"==typeof b?b:a(b);if(typeof b.toString==l)return b.toString();try{return String(b)}catch(c){return Object.prototype.toString.call(b)}}function b(a,b){return a.equals(b)}function c(a,b){return typeof b.equals==l?b.equals(a):a===b}function d(a){return function(b){if(null===b)throw Error("null is not a valid "+a);if("undefined"==typeof b)throw Error(a+" must not be undefined");
}}function e(a,b,c,d){this[0]=a;this.entries=[];this.addEntry(b,c);null!==d&&(this.getEqualityFunction=function(){return d})}function f(a){return function(b){for(var c=this.entries.length,d,e=this.getEqualityFunction(b);c--;)if(d=this.entries[c],e(b,d[0]))switch(a){case w:return!0;case p:return d;case q:return[c,d[1]]}return!1}}function g(a){return function(b){for(var c=b.length,d=0,e=this.entries.length;d<e;++d)b[c+d]=this.entries[d][a]}}function h(a,b){var c=a[b];return c&&c instanceof e?c:null}
function m(b,c){var d=this,f=[],g={},p=typeof b==l?b:a,q=typeof c==l?c:null;this.put=function(a,b){s(a);t(b);var c=p(a),d,k=null;(d=h(g,c))?(c=d.getEntryForKey(a))?(k=c[1],c[1]=b):d.addEntry(a,b):(d=new e(c,a,b,q),f[f.length]=d,g[c]=d);return k};this.get=function(a){s(a);var b=p(a);if(b=h(g,b))if(a=b.getEntryForKey(a))return a[1];return null};this.containsKey=function(a){s(a);var b=p(a);return(b=h(g,b))?b.containsKey(a):!1};this.containsValue=function(a){t(a);for(var b=f.length;b--;)if(f[b].containsValue(a))return!0;
return!1};this.clear=function(){f.length=0;g={}};this.isEmpty=function(){return!f.length};var v=function(a){return function(){for(var b=[],c=f.length;c--;)f[c][a](b);return b}};this.keys=v("keys");this.values=v("values");this.entries=v("getEntries");this.remove=function(a){s(a);var b=p(a),c=null,d=h(g,b);if(d&&(c=d.removeEntryForKey(a),null!==c&&!d.entries.length)){a:{for(a=f.length;a--;)if(d=f[a],b===d[0])break a;a=null}k(f,a);delete g[b]}return c};this.size=function(){for(var a=0,b=f.length;b--;)a+=
f[b].entries.length;return a};this.each=function(a){for(var b=d.entries(),c=b.length,e;c--;)e=b[c],a(e[0],e[1])};this.putAll=function(a,b){for(var c=a.entries(),e,f,g,h=c.length,k=typeof b==l;h--;){e=c[h];f=e[0];e=e[1];if(k&&(g=d.get(f)))e=b(f,g,e);d.put(f,e)}};this.clone=function(){var a=new m(b,c);a.putAll(d);return a};this.toString=function(){for(var a="",b=this.keys(),c=0;c<b.length;c++)var d=this.get(b[c]),a=a+(b[c].toString()+" = "+d.toString()+"\n");return a}}var l="function",k=typeof Array.prototype.splice==
l?function(a,b){a.splice(b,1)}:function(a,b){var c,d,e;if(b===a.length-1)a.length=b;else{c=a.slice(b+1);a.length=b;d=0;for(e=c.length;d<e;++d)a[b+d]=c[d]}},s=d("key"),t=d("value"),w=0,p=1,q=2;e.prototype={getEqualityFunction:function(a){return typeof a.equals==l?b:c},getEntryForKey:f(p),getEntryAndIndexForKey:f(q),removeEntryForKey:function(a){return(a=this.getEntryAndIndexForKey(a))?(k(this.entries,a[0]),a[1]):null},addEntry:function(a,b){this.entries[this.entries.length]=[a,b]},keys:g(0),values:g(1),
getEntries:function(a){for(var b=a.length,c=0,d=this.entries.length;c<d;++c)a[b+c]=this.entries[c].slice(0)},containsKey:f(w),containsValue:function(a){for(var b=this.entries.length;b--;)if(a===this.entries[b][1])return!0;return!1}};return m}();gamecore.LinkedListNode=gamecore.Base("gamecore.LinkedNode",{},{obj:null,nextLinked:null,prevLinked:null,free:!0,next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}});
gamecore.LinkedList=gamecore.Base("gamecore.LinkedList",{},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super();this.objToNodeMap=new gamecore.Hashtable},getNode:function(a){return this.objToNodeMap.get(a.getUniqueId())},addNode:function(a){var b=new gamecore.LinkedNode;b.obj=a;b.prevLinked=null;b.nextLinked=null;b.free=!1;this.objToNodeMap.put(a.getUniqueId(),b);return b},add:function(a){var b=this.getNode(a);if(null==b)b=this.addNode(a);else{if(!1==b.free)throw"Attempting to add object: "+
a.getUniqueId()+" twice to list "+this.getUniqueId();b.obj=a;b.free=!1;b.nextLinked=null;b.prevLinked=null}if(null==this.first)this.last=this.first=b,b.nextLinked=null,b.prevLinked=null;else{if(null==this.last)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=b;b.prevLinked=this.last;this.last=b;b.nextLinked=null}this.count++;this.showDebug&&this.dump("after add")},has:function(a){a=this.getNode(a);return!(null==a||!0==a.free)},moveUp:function(a){this.dump("before move up");
a=this.getNode(a);if(!a)throw"Oops, trying to move an object that isn't in the list";if(null!=a.prevLinked){var b=a.prevLinked,c=b.prevLinked;a==this.last&&(this.last=b);var d=a.nextLinked;c&&(c.nextLinked=a);a.nextLinked=b;a.prevLinked=b.prevLinked;b.nextLinked=d;b.prevLinked=a;this.first==b&&(this.first=a)}},moveDown:function(a){a=this.getNode(a);if(!a)throw"Oops, trying to move an object that isn't in the list";if(null!=a.nextLinked){var b=a.nextLinked;this.moveUp(b.obj);this.last==b&&(this.last=
a)}},sort:function(a){for(var b=[],c=this.first;c;)b.push(c.object()),c=c.next();this.clear();b.sort(a);for(a=0;a<b.length;a++)this.add(b[a])},remove:function(a){this.showDebug&&this.dump("before remove of "+a);a=this.getNode(a);if(null==a||!0==a.free)return!1;null!=a.prevLinked&&(a.prevLinked.nextLinked=a.nextLinked);null!=a.nextLinked&&(a.nextLinked.prevLinked=a.prevLinked);null==a.prevLinked&&(this.first=a.nextLinked);null==a.nextLinked&&(this.last=a.prevLinked);a.free=!0;a.prevLinked=null;a.nextLinked=
null;this.count--;this.showDebug&&this.dump("after remove");return!0},clear:function(){for(var a=this.first;null!=a;)a.free=!0,a=a.nextLinked;this.first=null;this.count=0},length:function(){return this.count},dump:function(a){this.debug("===================="+a+"=====================");for(a=this.first;null!=a;)this.debug("{"+a.obj.toString()+"} previous="+(a.prevLinked?a.prevLinked.obj:"NULL")),a=a.next();this.debug("===================================");this.debug("Last: {"+(this.last?this.last.obj:
"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}")}});
gamecore.PerformanceMeasure=gamecore.Base.extend("gamecore.PerformanceMeasure",{history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(a){this.description=a;this.start();this.Class.history.push(this)},start:function(){this.timeStart=Date.now();this.memStart=gamecore.Device.getUsedHeap()},end:function(){this.timeEnd=Date.now();this.timeDelta=this.timeEnd-this.timeStart;this.memEnd=gamecore.Device.getUsedHeap();
this.memDelta=this.memEnd<this.memStart?0:this.memEnd-this.memStart;return this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(0==this.memDelta?"unknown":this.memDelta)+" byte(s)"}});
gamecore.Pool=gamecore.Base.extend("gamecore.Pool",{INITIAL_POOL_SIZE:1,pools:new gamecore.Hashtable,totalPooled:0,totalUsed:0,acquire:function(a){var b=this.getPool(a);if(void 0==b||null==b)b=new gamecore.Pool(a,this.INITIAL_POOL_SIZE),this.pools.put(a.fullName,b);return b.acquire()},release:function(a){var b=this.pools.get(a.Class.fullName);if(void 0==b)throw"Oops, trying to release an object of type "+a.Class.fullName+" but no pool exists. Did you new an object instead of using create.";b.release(a)},
getPool:function(a){return this.pools.get(a.fullName)},getStats:function(){for(var a="",b=this.pools.keys(),c=0;c<b.length;c++)var d=b[c],e=this.pools.get(d),a=a+(d+": "+e.getStats()+"\n");return a}},{freeList:null,expansion:1,traces:null,init:function(a,b){this._super();this.classType=a;this.freeList=[];this.expand(b)},startTracing:function(){this.tracing||(this.tracing=!0,this.traces?this.traces.clear():this.traces=new gamecore.Hashtable)},stopTracing:function(){this.tracing=!1},expand:function(a){gamecore.Pool.totalPooled+=
a;for(var b=0;b<a;b++)this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},acquire:function(){0>=this.freeList.length&&(this.expansion=Math.round(1.2*this.expansion)+1,this.expand(this.expansion));if(this.tracing){for(var a=printStackTrace(),b=a.length-1;0==a[b].indexOf("Class.addTo")&&0<b;)b--;var c=this.traces.get(a[b]);null==c?this.traces.put(a[b],{value:1}):c.value++}return this.freeList.pop()},release:function(a){this.freeList.push(a)},getStats:function(){var a=
this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){var a=a+"TRACING\n",b=this.traces.keys(),c;for(c in b)a+=b[c]+" ("+this.traces.get(b[c]).value+")\n"}return a},dump:function(a){this.info("================== "+a+" ===================");this.info("FREE");this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}});
gamecore.DualPool=gamecore.Pool.extend("gamecore.DualPool",{acquire:function(a){var b=this.getPool(a);if(void 0==b||null==b)b=new gamecore.DualPool(a,this.INITIAL_POOL_SIZE),this.pools.put(a.fullName,b);return b.acquire()},getStats:function(){for(var a="",b=this.pools.keys(),c=0;c<b.length;c++)var d=b[c],e=this.pools.get(d),a=a+(d+" (free: "+e.freeList.length()+" used: "+e.usedList.length()+")\n");return a}},{freeList:null,usedList:null,init:function(a,b){this.classType=a;this.usedList=new gamecore.LinkedList;
this.freeList=new gamecore.LinkedList;this.expand(b)},expand:function(a){gamecore.Pool.totalPooled+=a;for(var b=0;b<a;b++)this.freeList.add(new this.classType)},returnObj:null,acquire:function(){null==this.freeList.first&&this.expand(Math.round(this.size()/5)+1);this.returnObj=this.freeList.first.obj;this.freeList.remove(this.returnObj);this.returnObj.destroyed=!1;this.usedList.add(this.returnObj);if(this.tracing){for(var a=printStackTrace(),b=a.length-1;0==a[b].indexOf("Class.addTo")&&0<b;)b--;var c=
this.traces.get(a[b]);null==c?this.traces.put(a[b],{value:1}):c.value++}return this.returnObj},release:function(a){this.freeList.add(a);this.usedList.remove(a)},dump:function(a){this.info("================== "+a+" ===================");this.info("FREE");this.freeList.dump();this.info("USED");this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}});
gamecore.Pooled=gamecore.Base("gamecore.Pooled",{create:function(){return gamecore.Pool.acquire(this)},getPool:function(){return gamecore.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease();gamecore.Pool.release(this)},onRelease:function(){}});
gamecore.DualPooled=gamecore.Base("gamecore.DualPooled",{create:function(){return gamecore.DualPool.acquire(this)},getPool:function(){return gamecore.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease();gamecore.DualPool.release(this)},onRelease:function(){}});function printStackTrace(a){a=a||{guess:!0};var b=a.e||null;a=!!a.guess;var c=new printStackTrace.implementation,b=c.run(b);return a?c.guessAnonymousFunctions(b):b}
printStackTrace.implementation=function(){};
printStackTrace.implementation.prototype={run:function(a,b){a=a||this.createException();b=b||this.mode(a);return"other"===b?this.other(arguments.callee):this[b](a)},createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return a.arguments&&a.stack?"chrome":"string"===typeof a.message&&"undefined"!==typeof window&&window.opera?!a.stacktrace||-1<a.message.indexOf("\n")&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":!a.stack?"opera10a":0>a.stacktrace.indexOf("called from line")?
"opera10b":"opera11":a.stack?"firefox":"other"},instrumentFunction:function(a,b,c){a=a||window;var d=a[b];a[b]=function(){c.call(this,printStackTrace().slice(4));return a[b]._instrumented.apply(this,arguments)};a[b]._instrumented=d},deinstrumentFunction:function(a,b){a[b].constructor===Function&&(a[b]._instrumented&&a[b]._instrumented.constructor===Function)&&(a[b]=a[b]._instrumented)},chrome:function(a){a=(a.stack+"\n").replace(/^\S[^\(]+?[\n$]/gm,"").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,
"{anonymous}()@$1$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}()@$1").split("\n");a.pop();return a},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n")},opera11:function(a){var b=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;a=a.stacktrace.split("\n");for(var c=[],d=0,e=a.length;d<e;d+=2){var f=b.exec(a[d]);if(f){var g=f[4]+":"+f[1]+":"+f[2],f=f[3]||"global code",f=f.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,
"{anonymous}");c.push(f+"@"+g+" -- "+a[d+1].replace(/^\s+/,""))}}return c},opera10b:function(a){var b=/^(.*)@(.+):(\d+)$/;a=a.stacktrace.split("\n");for(var c=[],d=0,e=a.length;d<e;d++){var f=b.exec(a[d]);f&&c.push((f[1]?f[1]+"()":"global code")+"@"+f[2]+":"+f[3])}return c},opera10a:function(a){var b=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;a=a.stacktrace.split("\n");for(var c=[],d=0,e=a.length;d<e;d+=2){var f=b.exec(a[d]);f&&c.push((f[3]||"{anonymous}")+"()@"+f[2]+":"+f[1]+" -- "+
a[d+1].replace(/^\s+/,""))}return c},opera9:function(a){var b=/Line (\d+).*script (?:in )?(\S+)/i;a=a.message.split("\n");for(var c=[],d=2,e=a.length;d<e;d+=2){var f=b.exec(a[d]);f&&c.push("{anonymous}()@"+f[2]+":"+f[1]+" -- "+a[d+1].replace(/^\s+/,""))}return c},other:function(a){for(var b=/function\s*([\w\-$]+)?\s*\(/i,c=[],d,e;a&&a.arguments&&10>c.length;)d=b.test(a.toString())?RegExp.$1||"{anonymous}":"{anonymous}",e=Array.prototype.slice.call(a.arguments||[]),c[c.length]=d+"("+this.stringifyArguments(e)+
")",a=a.caller;return c},stringifyArguments:function(a){for(var b=[],c=Array.prototype.slice,d=0;d<a.length;++d){var e=a[d];void 0===e?b[d]="undefined":null===e?b[d]="null":e.constructor&&(e.constructor===Array?b[d]=3>e.length?"["+this.stringifyArguments(e)+"]":"["+this.stringifyArguments(c.call(e,0,1))+"..."+this.stringifyArguments(c.call(e,-1))+"]":e.constructor===Object?b[d]="#object":e.constructor===Function?b[d]="#function":e.constructor===String?b[d]='"'+e+'"':e.constructor===Number&&(b[d]=
e))}return b.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(b)try{return b.open("GET",a,!1),b.send(null),b.responseText}catch(c){}return""},createXMLHTTPObject:function(){for(var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<b.length;c++)try{return a=b[c](),this.createXMLHTTPObject=b[c],a}catch(d){}},
isSameDomain:function(a){return"undefined"!==typeof location&&-1!==a.indexOf(location.hostname)},getSource:function(a){a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n"));return this.sourceCache[a]},guessAnonymousFunctions:function(a){for(var b=0;b<a.length;++b){var c=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,d=a[b],e=/\{anonymous\}\(.*\)@(.*)/.exec(d);if(e){var f=c.exec(e[1]);f&&(c=f[1],e=f[2],f=f[3]||0,c&&(this.isSameDomain(c)&&e)&&(c=this.guessAnonymousFunction(c,e,f),a[b]=d.replace("{anonymous}",
c)))}}return a},guessAnonymousFunction:function(a,b,c){var d;try{d=this.findFunctionName(this.getSource(a),b)}catch(e){d="getSource failed with url: "+a+", exception: "+e.toString()}return d},findFunctionName:function(a,b){for(var c=/function\s+([^(]*?)\s*\(([^)]*)\)/,d=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*function\b/,e=/['"]?([0-9A-Za-z_]+)['"]?\s*[:=]\s*(?:eval|new Function)\b/,f="",g,h=Math.min(b,20),m,l=0;l<h;++l)if(g=a[b-l-1],m=g.indexOf("//"),0<=m&&(g=g.substr(0,m)),g)if(f=g+f,(g=d.exec(f))&&
g[1]||(g=c.exec(f))&&g[1]||(g=e.exec(f))&&g[1])return g[1];return"(?)"}};
